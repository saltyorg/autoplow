{{define "scan_stats"}}
<div class="grid grid-cols-2 gap-3 sm:gap-5 {{if .PlexTrackingEnabled}}lg:grid-cols-4{{else}}lg:grid-cols-3{{end}}">
    <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg">
        <div class="p-3 sm:p-5">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 sm:h-6 sm:w-6 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                <div class="ml-3 sm:ml-5 w-0 flex-1">
                    <dl>
                        <dt class="text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400 truncate">Pending</dt>
                        <dd class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white">{{.PendingScans}}</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>

    {{if .PlexTrackingEnabled}}
    <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg">
        <div class="p-3 sm:p-5">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 sm:h-6 sm:w-6 text-blue-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992m0 0v4.992m0-4.992L17.835 6.17a8.25 8.25 0 00-14.85 3.656m-1.08 4.474v4.992m0 0h4.992m-4.992 0l3.182 3.183a8.25 8.25 0 0013.803-3.7" />
                    </svg>
                </div>
                <div class="ml-3 sm:ml-5 w-0 flex-1">
                    <dl>
                        <dt class="text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400 truncate">Scanning</dt>
                        <dd class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white">{{.ScanningScans}}</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>
    {{end}}

    <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg">
        <div class="p-3 sm:p-5">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 sm:h-6 sm:w-6 text-green-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                <div class="ml-3 sm:ml-5 w-0 flex-1">
                    <dl>
                        <dt class="text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400 truncate">Completed</dt>
                        <dd class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white">{{.CompletedScans}}</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>

    <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg">
        <div class="p-3 sm:p-5">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 sm:h-6 sm:w-6 text-red-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
                    </svg>
                </div>
                <div class="ml-3 sm:ml-5 w-0 flex-1">
                    <dl>
                        <dt class="text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400 truncate">Failed</dt>
                        <dd class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white">{{.FailedScans}}</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>

</div>
{{end}}

{{define "upload_stats"}}
    <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg">
        <div class="p-3 sm:p-5">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 sm:h-6 sm:w-6 text-blue-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
                    </svg>
                </div>
                <div class="ml-3 sm:ml-5 w-0 flex-1">
                    <dl>
                        <dt class="text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400 truncate">Uploading</dt>
                        <dd class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white">{{.ActiveUploads}}</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>

    <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg">
        <div class="p-3 sm:p-5">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 sm:h-6 sm:w-6 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z" />
                    </svg>
                </div>
                <div class="ml-3 sm:ml-5 w-0 flex-1">
                    <dl>
                        <dt class="text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400 truncate">Pending</dt>
                        <dd class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white">{{.PendingUploads}}</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>

    <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg">
        <div class="p-3 sm:p-5">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 sm:h-6 sm:w-6 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z" />
                    </svg>
                </div>
                <div class="ml-3 sm:ml-5 w-0 flex-1">
                    <dl>
                        <dt class="text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400 truncate">Queued</dt>
                        <dd class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white">{{.QueuedUploads}}</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>

    <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg">
        <div class="p-3 sm:p-5">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 sm:h-6 sm:w-6 text-green-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                <div class="ml-3 sm:ml-5 w-0 flex-1">
                    <dl>
                        <dt class="text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400 truncate">Completed</dt>
                        <dd class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white">{{.CompletedUploads}}</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>

    <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg">
        <div class="p-3 sm:p-5">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 sm:h-6 sm:w-6 text-red-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
                    </svg>
                </div>
                <div class="ml-3 sm:ml-5 w-0 flex-1">
                    <dl>
                        <dt class="text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400 truncate">Failed</dt>
                        <dd class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white">{{.FailedUploads}}</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>
{{end}}

{{define "stats"}}
{{template "scan_stats" .}}
{{end}}

{{define "recent_scans"}}
<tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
    {{if .}}
    {{range .}}
    <tr>
        <td class="px-6 py-4 text-sm text-gray-900 dark:text-gray-100 break-all" title="{{.Path}}">{{.Path}}</td>
        <td class="px-6 py-4 whitespace-nowrap">
            <span class="inline-flex items-center rounded-md px-2 py-1 text-xs font-medium
                {{if eq .Status "completed"}}bg-green-50 text-green-700 dark:bg-green-900/50 dark:text-green-400{{end}}
                {{if eq .Status "pending"}}bg-yellow-50 text-yellow-700 dark:bg-yellow-900/50 dark:text-yellow-400{{end}}
                {{if eq .Status "scanning"}}bg-blue-50 text-blue-700 dark:bg-blue-900/50 dark:text-blue-400{{end}}
                {{if eq .Status "failed"}}bg-red-50 text-red-700 dark:bg-red-900/50 dark:text-red-400{{end}}
                {{if eq .Status "skipped"}}bg-gray-50 text-gray-700 dark:bg-gray-700 dark:text-gray-300{{end}}
            ">{{.Status}}</span>
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{{.Trigger}}</td>
    </tr>
    {{end}}
    {{else}}
    <tr>
        <td colspan="3" class="px-6 py-4 text-sm text-gray-500 dark:text-gray-400 text-center">No scans yet</td>
    </tr>
    {{end}}
</tbody>
{{end}}

{{define "recent_uploads"}}
<tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
    {{if .}}
    {{range .}}
    <tr>
        <td class="px-6 py-4 text-sm text-gray-900 dark:text-gray-100">
            <div class="break-all" title="{{.Path}}">{{.Path}}</div>
            {{if eq .Status "uploading"}}
            <div class="mt-1 w-full bg-gray-200 dark:bg-gray-600 rounded-full h-1.5">
                <div class="bg-blue-600 h-1.5 rounded-full transition-all duration-500" style="width: {{.Progress}}%"></div>
            </div>
            {{end}}
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
            <span class="inline-flex items-center rounded-md px-2 py-1 text-xs font-medium
                {{if eq .Status "completed"}}bg-green-50 text-green-700 dark:bg-green-900/50 dark:text-green-400{{end}}
                {{if eq .Status "queued"}}bg-yellow-50 text-yellow-700 dark:bg-yellow-900/50 dark:text-yellow-400{{end}}
                {{if eq .Status "uploading"}}bg-blue-50 text-blue-700 dark:bg-blue-900/50 dark:text-blue-400{{end}}
                {{if eq .Status "failed"}}bg-red-50 text-red-700 dark:bg-red-900/50 dark:text-red-400{{end}}
                {{if eq .Status "paused"}}bg-gray-50 text-gray-700 dark:bg-gray-700 dark:text-gray-300{{end}}
            ">{{.Status}}{{if eq .Status "uploading"}} ({{.Progress}}%){{end}}</span>
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{{.Remote}}</td>
    </tr>
    {{end}}
    {{else}}
    <tr>
        <td colspan="3" class="px-6 py-4 text-sm text-gray-500 dark:text-gray-400 text-center">No uploads yet</td>
    </tr>
    {{end}}
</tbody>
{{end}}

{{define "active_sessions"}}
<div class="bg-white dark:bg-gray-800 shadow rounded-lg">
    <div class="px-4 py-5 sm:px-6 border-b border-gray-200 dark:border-gray-700">
        <h3 class="text-base font-semibold leading-6 text-gray-900 dark:text-white">Active Media Sessions</h3>
    </div>
    <div class="overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
            <thead class="bg-gray-50 dark:bg-gray-700">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Server</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">User</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Title</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Format</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Bitrate</th>
                </tr>
            </thead>
            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                {{if .}}
                {{range .}}
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">{{.Server}}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{{.User}}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100 truncate max-w-xs">{{.Title}}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{{.Format}}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{{.Bitrate}}</td>
                </tr>
                {{end}}
                {{else}}
                <tr>
                    <td colspan="5" class="px-6 py-4 text-sm text-gray-500 dark:text-gray-400 text-center">No active sessions</td>
                </tr>
                {{end}}
            </tbody>
        </table>
    </div>
</div>
{{end}}

{{define "throttle_status"}}
{{if .}}
<div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg">
    <div class="p-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <svg class="h-8 w-8 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
                    </svg>
                </div>
                <div class="ml-4">
                    <div class="flex items-center">
                        <h3 class="text-sm font-medium text-gray-900 dark:text-white">Bandwidth Throttle</h3>
                        <span class="ml-2 inline-flex items-center rounded-md px-2 py-0.5 text-xs font-medium {{.StatusClass}}">{{.StatusText}}</span>
                    </div>
                    <p class="text-sm text-gray-500 dark:text-gray-400">
                        {{if .Enabled}}
                        Current: <span class="font-medium text-gray-900 dark:text-white">{{.CurrentLimit}}</span>
                        {{if gt .SessionCount 0}}
                        · <span class="text-yellow-600 dark:text-yellow-400">{{.SessionCount}} active stream{{if gt .SessionCount 1}}s{{end}}</span>
                        {{end}}
                        · Max: {{.MaxBandwidth}} · Per-stream: {{.StreamBandwidth}}
                        {{else}}
                        Throttling is disabled. <a href="/settings/throttle" class="text-indigo-600 dark:text-indigo-400 hover:underline">Configure</a>
                        {{end}}
                    </p>
                </div>
            </div>
            <a href="/settings/throttle" class="text-sm text-indigo-600 dark:text-indigo-400 hover:text-indigo-500">
                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            </a>
        </div>
    </div>
</div>
{{end}}
{{end}}

{{define "content"}}
<div class="space-y-6">
    <div>
        <h1 class="text-2xl font-semibold text-gray-900 dark:text-white">Dashboard</h1>
    </div>

    {{if and .Content .Content.UploadsEnabled}}
    <!-- Throttle Status -->
    <div id="throttle-status-section" hx-get="/dashboard/throttle" hx-trigger="load, sse-refresh" hx-swap="innerHTML" data-sse-polling-fallback="10s">
        {{if .Content.ThrottleStatus}}
        {{template "throttle_status" .Content.ThrottleStatus}}
        {{end}}
    </div>
    {{end}}

    {{if and .Content .Content.ScanningEnabled}}
    <!-- Scans Section -->
    <div class="space-y-6">
        <div>
            <h2 class="text-lg font-medium text-gray-900 dark:text-white">Scans</h2>
            <p class="mt-1 text-sm text-gray-700 dark:text-gray-300">Current scan activity.</p>
        </div>

        <!-- Scan Stats -->
        <div id="dashboard-stats" hx-get="/dashboard/stats" hx-trigger="load, sse-refresh" hx-swap="innerHTML" data-sse-polling-fallback="5s">
            {{if .Content}}
            {{template "scan_stats" .Content.Stats}}
            {{else}}
            {{template "scan_stats" .}}
            {{end}}
        </div>
    </div>
    {{end}}

    {{if and .Content .Content.UploadsEnabled}}
    <!-- Uploads Section -->
    <div class="space-y-6">
        <div>
            <h2 class="text-lg font-medium text-gray-900 dark:text-white">Uploads</h2>
            <p class="mt-1 text-sm text-gray-700 dark:text-gray-300">Current upload activity.</p>
        </div>

        <!-- Upload Stats -->
        <div id="dashboard-upload-stats" class="grid grid-cols-2 gap-3 sm:gap-5 lg:grid-cols-5" hx-get="/dashboard/upload-stats" hx-trigger="load, sse-refresh" hx-swap="innerHTML" data-sse-polling-fallback="5s">
            {{if .Content}}
            {{template "upload_stats" .Content.Stats}}
            {{else}}
            {{template "upload_stats" .}}
            {{end}}
        </div>
    </div>
    {{end}}

    <!-- Active Sessions (always shown - sessions are tracked independently of uploads) -->
    <div id="active-sessions" hx-get="/dashboard/sessions" hx-trigger="load, sse-refresh" hx-swap="innerHTML" data-sse-polling-fallback="10s">
        {{if .Content}}
        {{template "active_sessions" .Content.ActiveSessions}}
        {{end}}
    </div>
</div>
{{end}}

{{template "base" .}}
